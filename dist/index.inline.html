<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Quiz interattivo sui proverbi in dialetto italiano. Metti alla prova la tua conoscenza dei detti popolari regionali.">
    <meta name="keywords" content="quiz, proverbi, dialetto, italiano, tradizioni, cultura popolare">
    <meta name="author" content="Quiz Dialetti">
    <meta name="robots" content="index, follow">
    
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="Quiz: Proverbi in Dialetto">
    <meta property="og:description" content="Metti alla prova la tua conoscenza dei proverbi regionali italiani">
    <meta property="og:locale" content="it_IT">
    
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Quiz: Proverbi in Dialetto">
    <meta name="twitter:description" content="Metti alla prova la tua conoscenza dei proverbi regionali italiani">
    
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none'; upgrade-insecure-requests;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <title>Quiz: Proverbi in Dialetto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    <style>.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}.btn:focus-visible,button:focus-visible{outline:3px solid var(--gold);outline-offset:2px;box-shadow:0 0 0 5px rgba(218,165,32,0.3);}.error-message{background:linear-gradient(135deg,#FFE4E1 0%,#FFF0F5 100%);border:2px solid #DC143C;border-radius:10px;padding:2rem;margin:2rem 0;text-align:center;box-shadow:0 4px 15px rgba(220,20,60,0.2);}.error-message h3{color:#DC143C;font-size:1.5rem;margin:0 0 1rem 0;font-family:'Cinzel',serif;}.error-message p{color:#8B0000;margin:0.5rem 0;font-size:1rem;}.error-retry-btn{background:linear-gradient(135deg,#DC143C 0%,#B22222 100%);color:white;border:2px solid #8B0000;padding:1rem 2rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s ease;margin-top:1rem;}.error-retry-btn:hover{background:linear-gradient(135deg,#B22222 0%,#8B0000 100%);transform:translateY(-2px);box-shadow:0 4px 12px rgba(220,20,60,0.4);}.notification{position:fixed;top:20px;right:20px;max-width:400px;padding:1rem 1.5rem;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:1000;display:flex;justify-content:space-between;align-items:center;animation:slideInRight 0.3s ease-out;font-weight:500;}.notification-success{background:linear-gradient(135deg,#D4F8D4 0%,#A8E6A8 100%);border:2px solid #4CAF50;color:#2E7D2E;}.notification-error{background:linear-gradient(135deg,#FFE4E1 0%,#FFB6C1 100%);border:2px solid #DC143C;color:#8B0000;}.notification-info{background:linear-gradient(135deg,#E3F2FD 0%,#BBDEFB 100%);border:2px solid #2196F3;color:#1565C0;}.notification button{background:none;border:none;font-size:1.2rem;font-weight:bold;cursor:pointer;padding:0.2rem 0.5rem;border-radius:4px;margin-left:1rem;transition:background-color 0.2s ease;}.notification-success button{color:#2E7D2E;}.notification-success button:hover{background-color:rgba(46,125,46,0.1);}.notification-error button{color:#8B0000;}.notification-error button:hover{background-color:rgba(139,0,0,0.1);}.notification-info button{color:#1565C0;}.notification-info button:hover{background-color:rgba(21,101,192,0.1);}@keyframes slideInRight{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}@media (hover:none) and (pointer:coarse){.btn:hover::before,#start-button:hover::before,#next-button:hover::before,#restart-button:hover::before{opacity:0;}.btn:hover:not([disabled]),#start-button:hover,#next-button:hover,#restart-button:hover,#review-button:hover,.review-btn:hover:not(:disabled){transform:none;}.btn:active{transform:scale(0.98);}}@media (prefers-reduced-motion:reduce){.container{animation:none;}.btn{animation:none;transition:none;}.review-progress::before{animation:none;}*{animation-duration:0.01ms !important;animation-iteration-count:1 !important;transition-duration:0.01ms !important;}}:root{--primary-color:#8B4513;--secondary-color:#FAF0E6;--accent-color:#D2B48C;--text-color:#2F1B14;--header-color:#654321;--correct-color:#228B22;--wrong-color:#B22222;--white:#FFF8DC;--gold:#DAA520;--shadow-light:rgba(0,0,0,0.1);--shadow-medium:rgba(0,0,0,0.15);--shadow-heavy:rgba(0,0,0,0.25);--font-serif:'Crimson Text',Georgia,serif;--font-display:'Cinzel','Times New Roman',serif;--font-mono:'Courier New',monospace;--font-size-base:18px;--font-scale-step:1.12;--line-height-base:1.55;--radius-sm:4px;--radius-md:10px;--radius-lg:18px;--space-1:.25rem;--space-2:.5rem;--space-3:.75rem;--space-4:1rem;--space-5:1.5rem;--space-6:2rem;--space-7:3rem;--focus-ring:0 0 0 3px rgba(218,165,32,.6),0 0 0 6px rgba(218,165,32,.25);--transition-fast:.15s ease;--transition-base:.3s ease;--elevation-1:0 2px 4px rgba(0,0,0,.08);--elevation-2:0 4px 12px rgba(0,0,0,.12);--elevation-3:0 8px 24px rgba(0,0,0,.18);--progress-bg:rgba(0,0,0,.08);--progress-fill:linear-gradient(90deg,var(--gold),var(--primary-color));}body.theme-dark{--secondary-color:#1F1C19;--white:#2A2623;--text-color:#E7E0D8;--header-color:#3A2E26;--primary-color:#5A3A24;--accent-color:#856446;--shadow-light:rgba(0,0,0,.4);--shadow-medium:rgba(0,0,0,.55);--shadow-heavy:rgba(0,0,0,.65);--progress-bg:rgba(255,255,255,.15);}body.theme-contrast{--secondary-color:#FFFFFF;--white:#FFFFFF;--text-color:#000000;--header-color:#000000;--primary-color:#000000;--accent-color:#222222;--gold:#FFCC00;--correct-color:#007A00;--wrong-color:#990000;--progress-bg:#00000022;}body.theme-contrast .container,body.theme-contrast .btn,body.theme-contrast #start-button,body.theme-contrast #next-button,body.theme-contrast #restart-button{box-shadow:none !important;}#progress-wrapper{display:flex;align-items:center;justify-content:space-between;font-family:var(--font-display);font-size:.95rem;letter-spacing:.5px;background:var(--progress-bg);padding:var(--space-2) var(--space-4);border-radius:var(--radius-md);box-shadow:var(--elevation-1);margin-bottom:var(--space-4);position:relative;overflow:hidden;}#progress-wrapper::after{content:"";position:absolute;inset:0;background:var(--progress-fill);width:var(--progress-percent,0%);opacity:.18;transition:width var(--transition-base);}#progress-text{position:relative;z-index:1;font-weight:600;}#global-progress{position:fixed;top:0;left:0;right:0;height:5px;background:rgba(0,0,0,0.08);z-index:2000;}#global-progress .gp-bar{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--gold),var(--primary-color));transition:width 0.4s ease;}.preferences-toolbar{display:flex;flex-wrap:wrap;gap:var(--space-2);margin-bottom:var(--space-4);align-items:center;}.preferences-toolbar button,.preferences-toolbar select{font-family:var(--font-serif);font-size:.85rem;padding:.5rem .9rem;border:1px solid var(--accent-color);background:var(--white);border-radius:var(--radius-sm);cursor:pointer;transition:background var(--transition-fast),color var(--transition-fast),border-color var(--transition-fast);}.preferences-toolbar button:hover,.preferences-toolbar select:hover{background:var(--accent-color);color:var(--text-color);}.preferences-toolbar button:focus-visible{outline:none;box-shadow:var(--focus-ring);}html.font-scale-1{font-size:calc(var(--font-size-base) * 0.94);}html.font-scale-2{font-size:var(--font-size-base);}html.font-scale-3{font-size:calc(var(--font-size-base) * 1.08);}html.font-scale-4{font-size:calc(var(--font-size-base) * 1.18);}html.font-scale-5{font-size:calc(var(--font-size-base) * 1.28);}@media print{body{background:#fff !important;}.site-header,.controls,.result-buttons,.preferences-toolbar,#start-screen,#quiz-screen,#review-screen .review-controls{display:none !important;}#result-screen,#answers-summary{display:block !important;}.summary-item{page-break-inside:avoid;border:1px solid #999;}}*{box-sizing:border-box;}.btn{will-change:transform;backface-visibility:hidden;transform:translateZ(0);}.btn:hover:not([disabled]){transform:translateY(-4px) scale(1.02) translateZ(0);}#start-button:hover,#next-button:hover,#restart-button:hover{transform:translateY(-5px) scale(1.03) translateZ(0);}.review-btn:hover:not(:disabled){transform:translateY(-3px) translateZ(0);}.review-btn.exit-btn:hover{transform:translateY(-3px) scale(1.05) translateZ(0);}.btn:not(:hover){will-change:auto;}body{font-family:'Crimson Text',serif;display:flex;flex-direction:column;align-items:center;min-height:100vh;margin:0;background:linear-gradient(135deg,var(--secondary-color) 0%,#F5E6D3 50%,#E8D5B7 100%);color:var(--text-color);background-attachment:fixed;background-image:radial-gradient(circle at 25% 25%,rgba(218,165,32,0.08) 0%,transparent 50%),radial-gradient(circle at 75% 75%,rgba(139,69,19,0.08) 0%,transparent 50%),repeating-linear-gradient( 0deg,transparent,transparent 200px,rgba(218,165,32,0.02) 200px,rgba(218,165,32,0.02) 201px );}.site-header{width:100%;background:linear-gradient(135deg,var(--header-color) 0%,var(--primary-color) 50%,var(--header-color) 100%);color:var(--white);padding:2rem 0;text-align:center;box-shadow:0 4px 15px var(--shadow-medium),inset 0 1px 0 rgba(255,255,255,0.1);border-bottom:3px solid var(--gold);position:relative;overflow:hidden;}.site-header::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background-image:repeating-linear-gradient( 45deg,transparent,transparent 20px,rgba(218,165,32,0.06) 20px,rgba(218,165,32,0.06) 21px ),repeating-linear-gradient( -45deg,transparent,transparent 20px,rgba(139,69,19,0.06) 20px,rgba(139,69,19,0.06) 21px );pointer-events:none;}.site-header h1{margin:0;font-size:2.5rem;font-weight:700;font-family:'Cinzel',serif;text-shadow:2px 2px 4px rgba(0,0,0,0.5),0 0 20px rgba(218,165,32,0.3);letter-spacing:2px;position:relative;z-index:1;color:var(--white);}.container{width:950px;max-width:95%;background:linear-gradient(145deg,var(--white) 0%,#F8F0E3 100%);border-radius:20px;padding:3.5rem;box-shadow:0 15px 35px var(--shadow-medium),0 5px 15px var(--shadow-light),inset 0 1px 0 rgba(255,255,255,0.9);margin-top:2.5rem;margin-bottom:2.5rem;text-align:center;border:3px solid var(--accent-color);position:relative;}.container::before{content:"";position:absolute;top:20px;left:20px;right:20px;bottom:20px;border:2px solid var(--gold);border-radius:15px;pointer-events:none;opacity:0.4;background:linear-gradient(45deg,transparent 25%,rgba(218,165,32,0.02) 25%,rgba(218,165,32,0.02) 50%,transparent 50%,transparent 75%,rgba(218,165,32,0.02) 75%);background-size:40px 40px;}.hidden{display:none;}#question-container{margin-bottom:2rem;}.btn-grid{display:grid;grid-template-columns:1fr;gap:1.2rem;margin-top:2rem;}@media (min-width:768px){.btn-grid{grid-template-columns:repeat(2,1fr);gap:1.5rem;}}#question{font-size:1.9rem;margin-bottom:3rem;font-weight:500;line-height:1.7;color:var(--text-color);text-align:left;padding:2rem 2.5rem;background:linear-gradient(135deg,rgba(218,165,32,0.08) 0%,rgba(218,165,32,0.04) 100%);border-left:5px solid var(--gold);border-radius:0 15px 15px 0;font-style:italic;position:relative;box-shadow:0 4px 15px var(--shadow-light);}#question::before{content:"";position:absolute;top:-10px;left:10px;font-size:4rem;color:var(--gold);opacity:0.3;font-family:'Cinzel',serif;}#question::after{content:"";position:absolute;bottom:-20px;right:20px;font-size:4rem;color:var(--gold);opacity:0.3;font-family:'Cinzel',serif;}.btn-grid{display:grid;grid-template-columns:1fr;gap:1rem;margin-top:1.5rem;}@media (max-width:768px){.site-header h1{font-size:2rem;letter-spacing:1px;}.container{padding:2rem;margin-top:1rem;margin-bottom:1rem;}#question{font-size:1.5rem;padding:1.5rem;margin-bottom:2rem;}.btn{padding:1.2rem 1rem;font-size:1rem;}#start-screen h2,#result-screen h2{font-size:2.2rem;margin-bottom:1.5rem;}#score{font-size:2.2rem;}.result-buttons{flex-direction:column;gap:1rem;}#restart-button,#review-button{max-width:100%;min-width:auto;}.review-controls{flex-direction:column;gap:0.8rem;}.review-btn{min-width:200px;}}@media (max-width:480px){.site-header h1{font-size:1.8rem;}.container{padding:1.5rem;}#question{font-size:1.3rem;padding:1rem;}.btn{padding:1rem 0.8rem;font-size:0.95rem;}#start-button,#next-button,#restart-button{padding:1rem 2rem;font-size:1rem;letter-spacing:1px;}}.container{animation:fadeInUp 0.6s ease-out;}@keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);}}.btn{animation:fadeInScale 0.4s ease-out backwards;}.btn:nth-child(1){animation-delay:0.1s;}.btn:nth-child(2){animation-delay:0.2s;}.btn:nth-child(3){animation-delay:0.3s;}.btn:nth-child(4){animation-delay:0.4s;}@keyframes fadeInScale{from{opacity:0;transform:scale(0.9);}to{opacity:1;transform:scale(1);}}.answers-summary::-webkit-scrollbar{width:8px;}.answers-summary::-webkit-scrollbar-track{background:var(--secondary-color);border-radius:4px;}.answers-summary::-webkit-scrollbar-thumb{background:var(--accent-color);border-radius:4px;border:1px solid var(--primary-color);}.answers-summary::-webkit-scrollbar-thumb:hover{background:var(--primary-color);}.btn{background:linear-gradient(135deg,var(--white) 0%,#F5E6D3 50%,var(--white) 100%);border:2px solid var(--accent-color);border-radius:10px;padding:1.4rem 1.6rem;color:var(--text-color);cursor:pointer;font-size:1.1rem;font-family:'Crimson Text',serif;font-weight:500;text-align:left;transition:all 0.4s ease;box-shadow:0 4px 15px var(--shadow-light),inset 0 1px 0 rgba(255,255,255,0.8);position:relative;overflow:hidden;}.btn::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(135deg,var(--primary-color) 0%,var(--header-color) 100%);opacity:0;transition:all 0.4s ease;z-index:0;}.btn span{position:relative;z-index:1;}.btn:hover:not([disabled]){transform:translateY(-4px) scale(1.02);box-shadow:0 8px 25px var(--shadow-medium),inset 0 1px 0 rgba(255,255,255,0.9);color:var(--white);border-color:var(--gold);}.btn:hover:not([disabled])::before{left:0;opacity:1;}.btn.correct{background:linear-gradient(135deg,#228B22 0%,#32CD32 50%,#228B22 100%);border-color:#228B22;color:#FFFFFF;font-weight:600;box-shadow:0 6px 20px rgba(34,139,34,0.4),inset 0 1px 0 rgba(255,255,255,0.3);transform:translateY(-2px) scale(1.02);}.btn.wrong{background:linear-gradient(135deg,var(--primary-color) 0%,var(--header-color) 50%,var(--primary-color) 100%);border-color:var(--primary-color);color:#FFFFFF;font-weight:600;box-shadow:0 6px 20px rgba(139,69,19,0.4),inset 0 1px 0 rgba(255,255,255,0.2);transform:translateY(-1px);}.btn.correct::before,.btn.wrong::before{opacity:0;}.btn:disabled{cursor:not-allowed;opacity:1;transform:none;}.btn{opacity:1 !important;}#review-screen .btn{opacity:1 !important;background:#F5F5F5 !important;color:#333 !important;border:2px solid #DDD !important;font-weight:normal !important;box-shadow:0 2px 5px rgba(0,0,0,0.1) !important;}#review-screen .btn.user-selected{opacity:1 !important;transform:scale(1.1) !important;box-shadow:0 8px 20px rgba(0,0,0,0.3) !important;font-weight:bold !important;}#review-screen .btn.correct{opacity:1 !important;background:#90EE90 !important;color:#006400 !important;border:3px solid #32CD32 !important;font-weight:bold !important;}#review-screen .btn.wrong:not(.user-selected){opacity:1 !important;background:linear-gradient(135deg,var(--primary-color) 0%,var(--header-color) 50%,var(--primary-color) 100%) !important;color:#FFFFFF !important;border:3px solid var(--primary-color) !important;font-weight:bold !important;}#review-screen .btn.user-selected.correct{background:#90EE90 !important;color:#006400 !important;border:3px solid #32CD32 !important;transform:scale(1.1) !important;box-shadow:0 8px 20px rgba(34,139,34,0.5) !important;}#review-screen .btn.user-selected.wrong,#review-answers .btn.user-selected.wrong{background:#FF4444 !important;color:#FFFFFF !important;border:3px solid #DC143C !important;transform:scale(1.1) !important;box-shadow:0 8px 20px rgba(220,20,60,0.8) !important;font-weight:bold !important;}.controls{display:flex;justify-content:center;align-items:center;margin-top:2rem;}#start-button,#next-button,#restart-button{background:linear-gradient(135deg,var(--primary-color) 0%,var(--header-color) 50%,var(--primary-color) 100%);color:var(--white);border:3px solid var(--gold);padding:1.3rem 3rem;border-radius:12px;cursor:pointer;font-size:1.2rem;font-family:'Cinzel',serif;font-weight:700;text-transform:uppercase;letter-spacing:2px;transition:all 0.4s ease;box-shadow:0 6px 20px var(--shadow-medium),inset 0 1px 0 rgba(255,255,255,0.2);position:relative;overflow:hidden;}#start-button::before,#next-button::before,#restart-button::before{content:"";position:absolute;top:50%;left:50%;width:0;height:0;background:radial-gradient(circle,rgba(255,255,255,0.2),transparent);transition:all 0.5s ease;transform:translate(-50%,-50%);border-radius:50%;}#start-button:hover,#next-button:hover,#restart-button:hover{transform:translateY(-5px) scale(1.03);box-shadow:0 10px 30px var(--shadow-heavy),inset 0 1px 0 rgba(255,255,255,0.3);border-color:#FFD700;background:linear-gradient(135deg,var(--header-color) 0%,#4A2C17 50%,var(--header-color) 100%);}#start-button:hover::before,#next-button:hover::before,#restart-button:hover::before{width:300px;height:300px;}#start-button:disabled{background:linear-gradient(135deg,var(--accent-color) 0%,#C0C0C0 50%,var(--accent-color) 100%);color:var(--text-color);cursor:wait;transform:none;box-shadow:0 3px 8px var(--shadow-light);}#start-screen h2,#result-screen h2{font-size:2.8rem;margin-bottom:2rem;color:var(--header-color);font-family:'Cinzel',serif;font-weight:700;text-shadow:2px 2px 4px var(--shadow-light),0 0 20px rgba(218,165,32,0.2);position:relative;}#start-screen h2::after,#result-screen h2::after{content:"";position:absolute;bottom:-15px;left:50%;transform:translateX(-50%);width:120px;height:3px;background:linear-gradient(90deg,transparent,var(--gold),var(--primary-color),var(--gold),transparent);border-radius:2px;}#start-screen p{font-size:1.4rem;color:var(--text-color);font-style:italic;margin-bottom:2.5rem;line-height:1.6;max-width:600px;margin-left:auto;margin-right:auto;}#score{font-size:2.8rem;font-weight:700;color:var(--gold);text-shadow:2px 2px 4px var(--shadow-medium),0 0 15px rgba(218,165,32,0.4);font-family:'Cinzel',serif;margin:1.5rem 0;}.answers-summary{max-height:400px;overflow-y:auto;margin:2rem 0;padding:1rem;background-color:rgba(250,240,230,0.3);border-radius:8px;border:1px solid var(--accent-color);}.summary-item{margin-bottom:1.5rem;padding:1rem;background-color:var(--white);border-radius:6px;border-left:4px solid var(--accent-color);text-align:left;}.summary-question{font-size:1rem;font-weight:600;color:var(--text-color);margin-bottom:0.8rem;font-style:italic;}.summary-answer{padding:0.5rem 0.8rem;border-radius:4px;margin:0.3rem 0;font-size:0.95rem;}.user-answer.correct{background:#90EE90 !important;border:2px solid #32CD32 !important;color:#006400 !important;font-weight:600;box-shadow:0 4px 12px rgba(34,139,34,0.3);}.user-answer.wrong{background:#FF4444 !important;border:2px solid #DC143C !important;color:#FFFFFF !important;font-weight:600;box-shadow:0 4px 12px rgba(220,20,60,0.3);}.correct-answer{background:#90EE90 !important;border:2px solid #32CD32 !important;color:#006400 !important;font-style:italic;font-weight:600;box-shadow:0 4px 12px rgba(34,139,34,0.2);}.result-buttons{display:flex;gap:1.5rem;justify-content:center;align-items:center;margin-top:3rem;flex-wrap:wrap;}#restart-button,#review-button{flex:1;max-width:250px;min-width:200px;padding:1.2rem 2rem;border-radius:12px;font-size:1.1rem;font-family:'Cinzel',serif;font-weight:600;text-transform:uppercase;letter-spacing:1px;transition:all 0.4s ease;cursor:pointer;position:relative;overflow:hidden;border:none;box-shadow:0 6px 20px var(--shadow-light);}#restart-button{background:linear-gradient(135deg,var(--primary-color) 0%,var(--header-color) 100%);color:var(--white);}#review-button{background:linear-gradient(135deg,var(--gold) 0%,#B8860B 100%);color:var(--text-color);font-weight:700;position:relative;}#review-button::before{content:"📖";position:absolute;left:20px;top:50%;transform:translateY(-50%);font-size:1.3rem;transition:all 0.4s ease;}#review-button::after{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:all 0.6s ease;}#review-button:hover::after{left:100%;}#restart-button:hover,#review-button:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 10px 30px var(--shadow-medium);}#restart-button:hover{background:linear-gradient(135deg,var(--header-color) 0%,#4A2C17 100%);}#review-button:hover{background:linear-gradient(135deg,#FFD700 0%,var(--gold) 100%);color:var(--header-color);}#review-screen{text-align:center;position:relative;}#review-screen h2{font-size:2.2rem;margin-bottom:1rem;color:var(--header-color);font-family:'Cinzel',serif;text-shadow:1px 1px 3px var(--shadow-light);position:relative;}#review-screen h2::before{content:"📚";margin-right:15px;font-size:2rem;vertical-align:middle;}.review-progress{margin:1.5rem 0 2.5rem 0;padding:0.8rem 2rem;background:linear-gradient(135deg,var(--gold) 0%,#B8860B 100%);color:var(--white);border-radius:25px;display:inline-block;font-weight:700;font-size:1.1rem;text-shadow:1px 1px 2px rgba(0,0,0,0.3);box-shadow:0 4px 15px rgba(218,165,32,0.3),inset 0 1px 0 rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);position:relative;overflow:hidden;}.review-progress::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);animation:shimmer 2s infinite;}@keyframes shimmer{0%{left:-100%;}100%{left:100%;}}.review-controls{display:flex;gap:1rem;justify-content:center;align-items:center;margin-top:3rem;flex-wrap:wrap;position:relative;}.review-btn{background:linear-gradient(135deg,var(--white) 0%,#F5E6D3 100%);color:var(--text-color);border:2px solid var(--accent-color);padding:1rem 1.8rem;border-radius:10px;cursor:pointer;font-size:1rem;font-family:'Crimson Text',serif;font-weight:600;transition:all 0.3s ease;min-width:140px;position:relative;overflow:hidden;box-shadow:0 4px 12px var(--shadow-light);}.review-btn::before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(135deg,var(--primary-color),var(--header-color));transition:all 0.3s ease;z-index:-1;}.review-btn:hover:not(:disabled){color:var(--white);transform:translateY(-3px);box-shadow:0 8px 25px var(--shadow-medium);border-color:var(--gold);}.review-btn:hover:not(:disabled)::before{left:0;}.review-btn:disabled{opacity:0.4;cursor:not-allowed;transform:none;background:linear-gradient(135deg,#E0E0E0 0%,#C0C0C0 100%);color:#999;}#review-prev::after{content:" ← ";font-weight:bold;}#review-next::after{content:" → ";font-weight:bold;}.review-btn.exit-btn{background:linear-gradient(135deg,var(--correct-color) 0%,#32CD32 100%);color:var(--white);border-color:var(--correct-color);font-weight:700;min-width:160px;position:relative;}.review-btn.exit-btn::before{content:"✓";margin-right:8px;font-weight:bold;}.review-btn.exit-btn:hover{background:linear-gradient(135deg,#32CD32 0%,#228B22 100%);transform:translateY(-3px) scale(1.05);}#review-answers .btn.correct{background:linear-gradient(135deg,#228B22 0%,#32CD32 100%);border-color:#228B22;color:#FFFFFF;font-weight:600;box-shadow:0 4px 12px rgba(34,139,34,0.3);position:relative;}#review-answers .btn.wrong{background:linear-gradient(135deg,#654321 0%,#2F1B14 100%);border-color:#654321;color:#FFFFFF;font-weight:600;box-shadow:0 4px 12px rgba(101,67,33,0.3);position:relative;}#review-answers .btn.user-selected{border:3px solid var(--gold) !important;box-shadow:0 0 15px rgba(218,165,32,0.6) !important;}@keyframes ledBorder{0%{background-position:0% 0%;}25%{background-position:100% 0%;}50%{background-position:100% 100%;}75%{background-position:0% 100%;}100%{background-position:0% 0%;}}@keyframes ledRotate{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}@keyframes ledPulse{0%,100%{box-shadow:0 4px 12px rgba(34,139,34,0.3),0 0 20px rgba(255,255,255,0.2),0 0 30px rgba(255,255,255,0.1);}50%{box-shadow:0 4px 12px rgba(34,139,34,0.3),0 0 25px rgba(255,255,255,0.4),0 0 35px rgba(255,255,255,0.2),0 0 45px rgba(255,255,255,0.1);}}#review-answers .btn.correct.user-selected::after,#review-answers .btn.wrong.user-selected::after{content:"✓ La tua scelta";position:absolute;top:-35px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,var(--gold) 0%,#FFD700 100%);color:var(--text-color);padding:4px 12px;border-radius:15px;font-size:0.8rem;font-weight:700;white-space:nowrap;box-shadow:0 2px 8px rgba(218,165,32,0.4);z-index:10;animation:tagPulse 2s infinite;}#review-answers .btn.wrong.user-selected::after{content:"✗ La tua scelta";background:linear-gradient(135deg,#FF6B6B 0%,#FF5252 100%);color:white;box-shadow:0 2px 8px rgba(255,107,107,0.4);}.btn.selected-answer{transform:scale(1.1) !important;box-shadow:0 8px 20px rgba(0,0,0,0.3) !important;}</style>

    <meta name="x-questions-sha" content="089c115024">
</head>
<body>
    <header class="site-header">
        <h1>Proverbi in dialetto</h1>
    </header>
    <div class="container" id="app-container">
        <div class="preferences-toolbar" aria-label="Preferenze di visualizzazione" role="region">
            <button type="button" id="theme-toggle" aria-pressed="false">Tema Scuro</button>
            <button type="button" id="contrast-toggle" aria-pressed="false">Alto Contrasto</button>
            <div class="font-scale-group" role="group" aria-label="Dimensione carattere">
                <button type="button" id="font-dec" aria-label="Riduci dimensione testo">A-</button>
                <button type="button" id="font-reset" aria-label="Ripristina dimensione testo">A</button>
                <button type="button" id="font-inc" aria-label="Aumenta dimensione testo">A+</button>
            </div>
            <button type="button" id="print-btn" aria-label="Stampa risultati quiz" disabled>Stampa Risultati</button>
        </div>
        <main id="main" aria-live="polite">
        <div id="start-screen" aria-labelledby="welcome-title">
            <h2 id="welcome-title">Benvenuto al Quiz</h2>
            <p>Metti alla prova la tua conoscenza dei proverbi locali.</p>
            <button id="start-button" disabled aria-describedby="welcome-title">Caricamento...</button>
        </div>
        <div id="quiz-screen" class="hidden" aria-labelledby="quiz-title">
            <div id="question-container">
                <h2 id="quiz-title" class="sr-only">Quiz in corso</h2>
                <div id="progress-wrapper" aria-label="Progresso quiz">
                    <span id="progress-text">Domanda 1 di 10</span>
                </div>
                <h2 id="question" role="heading" aria-level="2">Domanda</h2>
                <div id="answer-buttons" class="btn-grid" role="group" aria-labelledby="question" aria-describedby="question">
                    
                </div>
            </div>
            <div class="controls">
                <button id="next-button" class="next-btn hidden" aria-label="Vai alla prossima domanda">Prossima Domanda</button>
            </div>
        </div>
        <div id="result-screen" class="hidden" aria-labelledby="result-title">
            <h2 id="result-title">Quiz Terminato</h2>
            <p>Il tuo punteggio finale è: <span id="score" aria-live="polite">0</span></p>
            
            <div id="answers-summary" class="answers-summary" role="region" aria-label="Riepilogo delle risposte">
                
            </div>
            
            <div class="result-buttons" role="group" aria-label="Azioni disponibili">
                <button id="restart-button" aria-label="Inizia un nuovo quiz">Rigioca</button>
                <button id="review-button" aria-label="Rivedi le domande e risposte">Revisione</button>
            </div>
        </div>
        
        <div id="review-screen" class="hidden" aria-labelledby="review-title">
            <h2 id="review-title">Revisione Quiz</h2>
            <div class="review-progress" aria-live="polite">
                <span id="review-counter">1 di 10</span>
            </div>
            
            <div id="review-question-container">
                <h3 id="review-question" role="heading" aria-level="3">Domanda</h3>
                <div id="review-answers" class="btn-grid" role="group" aria-labelledby="review-question" aria-describedby="review-counter">
                    
                </div>
            </div>
            
            <div class="review-controls" role="group" aria-label="Controlli di navigazione revisione">
                <button id="review-prev" class="review-btn" aria-label="Vai alla domanda precedente">← Precedente</button>
                <button id="review-next" class="review-btn" aria-label="Vai alla domanda successiva">Successiva →</button>
                <button id="review-exit" class="review-btn exit-btn" aria-label="Torna ai risultati del quiz">Torna ai Risultati</button>
            </div>
        </div>
        </main>
    </div>
    <div id="notification-region" aria-live="polite" role="status" class="sr-only"></div>
    <div id="global-progress" aria-hidden="true"><span class="gp-bar" id="global-progress-bar"></span></div>
    <script>const startButton = document.getElementById('start-button'); const nextButton = document.getElementById('next-button'); const restartButton = document.getElementById('restart-button'); const reviewButton = document.getElementById('review-button'); const reviewPrevButton = document.getElementById('review-prev'); const reviewNextButton = document.getElementById('review-next'); const reviewExitButton = document.getElementById('review-exit'); const startScreen = document.getElementById('start-screen'); const quizScreen = document.getElementById('quiz-screen'); const resultScreen = document.getElementById('result-screen'); const reviewScreen = document.getElementById('review-screen'); const questionContainerElement = document.getElementById('question-container'); const questionElement = document.getElementById('question'); const answerButtonsElement = document.getElementById('answer-buttons'); const scoreElement = document.getElementById('score'); const reviewQuestionElement = document.getElementById('review-question'); const reviewAnswersElement = document.getElementById('review-answers'); const reviewCounterElement = document.getElementById('review-counter'); const progressText = document.getElementById('progress-text'); const notificationRegion = document.getElementById('notification-region'); let allQuestions = []; let selectedQuestions = []; let currentQuestionIndex; let score = 0; let userAnswers = []; let reviewIndex = 0; const QuizState = { save: function() { try { const state = { selectedQuestions, currentQuestionIndex, score, userAnswers, timestamp: Date.now() }; localStorage.setItem('quiz-dialetti-state', JSON.stringify(state)); } catch (e) { console.warn('Impossibile salvare lo stato del quiz:', e); } }, load: function() { try { const saved = localStorage.getItem('quiz-dialetti-state'); if (saved) { const state = JSON.parse(saved); if (Date.now() - state.timestamp < 3600000) { return state; } } } catch (e) { console.warn('Impossibile caricare lo stato del quiz:', e); } return null; }, clear: function() { try { localStorage.removeItem('quiz-dialetti-state'); } catch (e) { console.warn('Impossibile cancellare lo stato del quiz:', e); } } }; function showNotification(message, type = 'info') { if (notificationRegion) { notificationRegion.textContent = message; } const notification = document.createElement('div'); notification.className = `notification notification-${type}`; notification.setAttribute('role', type === 'error' ? 'alert' : 'status'); const span = document.createElement('span'); span.textContent = message; const closeBtn = document.createElement('button'); closeBtn.setAttribute('aria-label', 'Chiudi notifica'); closeBtn.textContent = '×'; closeBtn.addEventListener('click', () => notification.remove()); notification.appendChild(span); notification.appendChild(closeBtn); document.body.appendChild(notification); setTimeout(() => { if (notification.parentElement) notification.remove(); }, 5000); } function shuffle(array) { const a = [...array]; for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } return a; } function normalizeQuestions(raw) { const placeholderRegex = /^\*+$|^\?+$/; return raw .filter(q => q && q.question && Array.isArray(q.answers)) .map(q => ({ question: String(q.question).trim(), answers: q.answers.filter(a => a && typeof a.text === 'string') })) .filter(q => q.answers.length === 4) .filter(q => { if (q.answers.some(a => placeholderRegex.test(a.text.trim()))) return false; const correctCount = q.answers.filter(a => a.correct === true).length; return correctCount === 1; }); } function selectRandomQuestions(questions, count = 10) { const cleaned = normalizeQuestions(questions); const mixed = shuffle(cleaned); return mixed.slice(0, Math.min(count, mixed.length)); } async function loadQuestions(retries = 3) { for (let i = 0; i < retries; i++) { try { const response = await fetch('questions.json'); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.json(); if (!Array.isArray(data) || data.length === 0) throw new Error('Dati del quiz non validi'); const validQuestions = data.filter(q => q.question && Array.isArray(q.answers)); allQuestions = normalizeQuestions(validQuestions); if (allQuestions.length < 10) { console.warn('Numero domande valide inferiore a 10, il quiz userà tutte le disponibili:', allQuestions.length); } startButton.disabled = false; startButton.innerText = 'Inizia'; const saved = QuizState.load(); if (saved && saved.selectedQuestions && saved.selectedQuestions.length) { const resume = confirm('Hai un quiz interrotto. Vuoi riprendere da dove avevi lasciato?'); if (resume) { selectedQuestions = saved.selectedQuestions; currentQuestionIndex = saved.currentQuestionIndex; score = saved.score || 0; userAnswers = saved.userAnswers || []; startScreen.classList.add('hidden'); quizScreen.classList.remove('hidden'); setNextQuestion(); updateProgress(); showNotification('Quiz ripristinato.', 'info'); return; } else { QuizState.clear(); } } return; } catch (err) { console.error(`Tentativo ${i + 1} fallito:`, err); if (i === retries - 1) { startButton.innerText = 'Riprova'; startButton.disabled = false; startButton.onclick = () => { startButton.disabled = true; startButton.innerText = 'Caricamento...'; loadQuestions(); }; const errorDiv = document.createElement('div'); errorDiv.className = 'error-message'; errorDiv.innerHTML = ` <h3>⚠️ Errore di Caricamento</h3> <p>Impossibile caricare le domande del quiz.</p> <p><strong>Dettagli:</strong> ${err.message}</p> <button class="btn error-retry-btn">🔄 Ricarica Pagina</button> `; errorDiv.querySelector('.error-retry-btn').addEventListener('click', () => location.reload()); const container = document.getElementById('start-screen'); container.appendChild(errorDiv); return; } await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1))); } } } loadQuestions(); document.addEventListener('keydown', function(e) { if (!quizScreen.classList.contains('hidden')) { const buttons = Array.from(answerButtonsElement.children); const activeElement = document.activeElement; const currentIndex = buttons.indexOf(activeElement); switch(e.key) { case 'ArrowDown': case 'ArrowRight': e.preventDefault(); if (currentIndex < buttons.length - 1) { buttons[currentIndex + 1].focus(); } else { buttons[0].focus(); } break; case 'ArrowUp': case 'ArrowLeft': e.preventDefault(); if (currentIndex > 0) { buttons[currentIndex - 1].focus(); } else { buttons[buttons.length - 1].focus(); } break; case 'Enter': case ' ': e.preventDefault(); if (buttons.includes(activeElement) && !activeElement.disabled) { activeElement.click(); } break; case 'Escape': if (confirm('Vuoi davvero uscire dal quiz? Il progresso andrà perso.')) { startGame(); } break; } } if (!reviewScreen.classList.contains('hidden')) { switch(e.key) { case 'ArrowLeft': e.preventDefault(); if (!reviewPrevButton.disabled) { reviewPrevButton.click(); } break; case 'ArrowRight': e.preventDefault(); if (!reviewNextButton.disabled) { reviewNextButton.click(); } break; case 'Escape': reviewExitButton.click(); break; } } }); startButton.addEventListener('click', startGame); nextButton.addEventListener('click', () => { currentQuestionIndex++; setNextQuestion(); }); restartButton.addEventListener('click', () => { if (confirm('Sei sicuro di voler ricominciare? Il progresso attuale andrà perso.')) { QuizState.clear(); startGame(); } }); reviewButton.addEventListener('click', startReview); reviewPrevButton.addEventListener('click', () => { if (reviewIndex > 0) { reviewIndex--; showReviewQuestion(); } }); reviewNextButton.addEventListener('click', () => { if (reviewIndex < userAnswers.length - 1) { reviewIndex++; showReviewQuestion(); } }); reviewExitButton.addEventListener('click', () => { reviewScreen.classList.add('hidden'); resultScreen.classList.remove('hidden'); setTimeout(() => restartButton.focus(), 100); }); window.addEventListener('beforeunload', function(e) { if (!quizScreen.classList.contains('hidden') && currentQuestionIndex > 0) { e.preventDefault(); e.returnValue = 'Hai un quiz in corso. Sei sicuro di voler uscire?'; return e.returnValue; } }); const PREF_KEY = 'quiz-dialetti-preferences'; const themeToggleBtn = document.getElementById('theme-toggle'); const contrastToggleBtn = document.getElementById('contrast-toggle'); const fontIncBtn = document.getElementById('font-inc'); const fontDecBtn = document.getElementById('font-dec'); const fontResetBtn = document.getElementById('font-reset'); const printBtn = document.getElementById('print-btn'); let fontScaleLevel = 2; function loadPreferences() { try { const raw = localStorage.getItem(PREF_KEY); if (!raw) return; const pref = JSON.parse(raw); if (pref.theme === 'dark') document.body.classList.add('theme-dark'); if (pref.contrast === true) document.body.classList.add('theme-contrast'); if (pref.fontScale && pref.fontScale >=1 && pref.fontScale <=5) { fontScaleLevel = pref.fontScale; applyFontScale(); } updatePrefButtons(); } catch(e) { console.warn('Preferenze non caricate', e); } } function savePreferences() { const pref = { theme: document.body.classList.contains('theme-dark') ? 'dark' : 'light', contrast: document.body.classList.contains('theme-contrast'), fontScale: fontScaleLevel }; try { localStorage.setItem(PREF_KEY, JSON.stringify(pref)); } catch(e) {} } function updatePrefButtons() { if (themeToggleBtn) themeToggleBtn.setAttribute('aria-pressed', document.body.classList.contains('theme-dark')); if (contrastToggleBtn) contrastToggleBtn.setAttribute('aria-pressed', document.body.classList.contains('theme-contrast')); if (themeToggleBtn) themeToggleBtn.textContent = document.body.classList.contains('theme-dark') ? 'Tema Chiaro' : 'Tema Scuro'; if (contrastToggleBtn) contrastToggleBtn.textContent = document.body.classList.contains('theme-contrast') ? 'Contrasto Normale' : 'Alto Contrasto'; } function applyFontScale() { document.documentElement.classList.remove('font-scale-1','font-scale-2','font-scale-3','font-scale-4','font-scale-5'); document.documentElement.classList.add(`font-scale-${fontScaleLevel}`); } if (themeToggleBtn) themeToggleBtn.addEventListener('click', () => { document.body.classList.toggle('theme-dark'); updatePrefButtons(); savePreferences(); }); if (contrastToggleBtn) contrastToggleBtn.addEventListener('click', () => { document.body.classList.toggle('theme-contrast'); updatePrefButtons(); savePreferences(); }); if (fontIncBtn) fontIncBtn.addEventListener('click', () => { if (fontScaleLevel < 5) { fontScaleLevel++; applyFontScale(); savePreferences(); }}); if (fontDecBtn) fontDecBtn.addEventListener('click', () => { if (fontScaleLevel > 1) { fontScaleLevel--; applyFontScale(); savePreferences(); }}); if (fontResetBtn) fontResetBtn.addEventListener('click', () => { fontScaleLevel = 2; applyFontScale(); savePreferences(); }); if (printBtn) printBtn.addEventListener('click', () => { window.print(); }); const observer = new MutationObserver(() => { if (printBtn) { const canPrint = !resultScreen.classList.contains('hidden'); printBtn.disabled = !canPrint; } }); observer.observe(resultScreen, { attributes:true, attributeFilter:['class'] }); loadPreferences(); function updateProgress() { if (progressText && selectedQuestions.length) { const current = Math.min(currentQuestionIndex + 1, selectedQuestions.length); progressText.textContent = `Domanda ${current} di ${selectedQuestions.length}`; const percent = ((current - 1) / selectedQuestions.length) * 100; const wrapper = document.getElementById('progress-wrapper'); if (wrapper) { wrapper.style.setProperty('--progress-percent', percent + '%'); } } } function startGame() { score = 0; userAnswers = []; startScreen.classList.add('hidden'); resultScreen.classList.add('hidden'); reviewScreen.classList.add('hidden'); quizScreen.classList.remove('hidden'); selectedQuestions = selectRandomQuestions(allQuestions, 10); currentQuestionIndex = 0; QuizState.clear(); setNextQuestion(); updateProgress(); setTimeout(() => { const firstButton = answerButtonsElement.querySelector('.btn'); if (firstButton) firstButton.focus(); }, 100); showNotification('Quiz avviato! Usa le frecce per navigare tra le risposte.', 'success'); } function setNextQuestion() { resetState(); if (selectedQuestions.length > currentQuestionIndex) { showQuestion(selectedQuestions[currentQuestionIndex]); updateProgress(); } else { showResult(); } } function sanitizeText(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; } function showQuestion(question) { questionElement.textContent = question.question; question.answers.forEach(answer => { const button = document.createElement('button'); const span = document.createElement('span'); span.textContent = sanitizeText(answer.text); button.appendChild(span); button.classList.add('btn'); button.setAttribute('role', 'button'); button.setAttribute('aria-label', `Risposta: ${answer.text}`); if (answer.correct) { button.dataset.correct = answer.correct; } button.addEventListener('click', selectAnswer); answerButtonsElement.appendChild(button); }); } function resetState() { clearStatusClass(document.body); nextButton.classList.add('hidden'); while (answerButtonsElement.firstChild) { const button = answerButtonsElement.firstChild; if (button && button.classList) { button.classList.remove('selected-answer', 'correct', 'wrong'); } answerButtonsElement.removeChild(button); } } function selectAnswer(e) { const selectedButton = e.target.closest('button'); const correct = selectedButton.dataset.correct === 'true'; selectedButton.classList.add('selected-answer'); userAnswers.push({ question: selectedQuestions[currentQuestionIndex].question, answers: selectedQuestions[currentQuestionIndex].answers, userAnswer: selectedButton.querySelector('span').textContent, userAnswerIndex: Array.from(answerButtonsElement.children).indexOf(selectedButton), correctAnswer: selectedQuestions[currentQuestionIndex].answers.find(ans => ans.correct).text, isCorrect: correct }); if (correct) { score++; showNotification('Risposta corretta! 🎉', 'success'); } else { showNotification('Risposta sbagliata 😔', 'error'); } setStatusClass(selectedButton, correct); Array.from(answerButtonsElement.children).forEach(button => { setStatusClass(button, button.dataset.correct === 'true'); button.disabled = true; }); QuizState.save(); nextButton.classList.remove('hidden'); nextButton.focus(); } function setStatusClass(element, correct) { clearStatusClass(element); if (correct) { element.classList.add('correct'); } else { element.classList.add('wrong'); } } function clearStatusClass(element) { element.classList.remove('correct'); element.classList.remove('wrong'); } function updateProgress() { if (progressText && selectedQuestions.length) { const cur = Math.min(currentQuestionIndex + 1, selectedQuestions.length); progressText.textContent = `Domanda ${cur} di ${selectedQuestions.length}`; } } function showResult() { quizScreen.classList.add('hidden'); resultScreen.classList.remove('hidden'); scoreElement.textContent = `${score} su ${selectedQuestions.length}`; const announcement = score >= Math.round(selectedQuestions.length * 0.7) ? `Complimenti! Hai ottenuto ${score} punti su ${selectedQuestions.length}. Ottimo risultato!` : score >= Math.round(selectedQuestions.length * 0.5) ? `Hai ottenuto ${score} punti su ${selectedQuestions.length}. Buon risultato!` : `Hai ottenuto ${score} punti su ${selectedQuestions.length}. Puoi migliorare!`; showNotification(announcement, score >= Math.round(selectedQuestions.length * 0.7) ? 'success' : score >= Math.round(selectedQuestions.length * 0.5) ? 'info' : 'error'); QuizState.clear(); const summaryContainer = document.getElementById('answers-summary'); summaryContainer.innerHTML = ''; userAnswers.forEach((answer) => { const summaryItem = document.createElement('div'); summaryItem.className = 'summary-item'; const questionText = document.createElement('div'); questionText.className = 'summary-question'; questionText.textContent = answer.question.replace(/
/g, ' '); const userAnswerDiv = document.createElement('div'); userAnswerDiv.className = `summary-answer user-answer ${answer.isCorrect ? 'correct' : 'wrong'}`; userAnswerDiv.innerHTML = `<strong>La tua risposta:</strong> ${sanitizeText(answer.userAnswer)}`; summaryItem.appendChild(questionText); summaryItem.appendChild(userAnswerDiv); if (!answer.isCorrect) { const correctAnswerDiv = document.createElement('div'); correctAnswerDiv.className = 'summary-answer correct-answer'; correctAnswerDiv.innerHTML = `<strong>Risposta corretta:</strong> ${sanitizeText(answer.correctAnswer)}`; summaryItem.appendChild(correctAnswerDiv); } summaryContainer.appendChild(summaryItem); }); setTimeout(() => restartButton.focus(), 100); } function startReview() { reviewIndex = 0; resultScreen.classList.add('hidden'); reviewScreen.classList.remove('hidden'); showReviewQuestion(); } function showReviewQuestion() { const currentAnswer = userAnswers[reviewIndex]; reviewCounterElement.textContent = `${reviewIndex + 1} di ${userAnswers.length}`; reviewQuestionElement.textContent = currentAnswer.question; reviewAnswersElement.innerHTML = ''; currentAnswer.answers.forEach((answer, index) => { const button = document.createElement('button'); const span = document.createElement('span'); span.textContent = sanitizeText(answer.text); button.appendChild(span); button.classList.add('btn'); button.disabled = true; button.setAttribute('role', 'button'); button.setAttribute('aria-label', `Risposta ${index + 1}: ${answer.text}`); if (index === currentAnswer.userAnswerIndex) { button.classList.add('user-selected'); button.setAttribute('aria-label', `La tua risposta: ${answer.text}`); if (currentAnswer.isCorrect) { button.classList.add('correct'); button.setAttribute('aria-label', `La tua risposta corretta: ${answer.text}`); } else { button.classList.add('wrong'); button.setAttribute('aria-label', `La tua risposta sbagliata: ${answer.text}`); } } else if (answer.correct) { button.classList.add('correct'); button.setAttribute('aria-label', `Risposta corretta: ${answer.text}`); } reviewAnswersElement.appendChild(button); }); reviewPrevButton.disabled = (reviewIndex === 0); reviewNextButton.disabled = (reviewIndex === userAnswers.length - 1); } const globalProgressBar = document.getElementById('global-progress-bar'); const _originalUpdateProgress = updateProgress; updateProgress = function() { _originalUpdateProgress(); if (globalProgressBar && selectedQuestions.length) { const current = Math.min(currentQuestionIndex, selectedQuestions.length); const percent = (current / selectedQuestions.length) * 100; globalProgressBar.style.width = percent + '%'; } }; const QUESTIONS_CACHE_KEY = 'quiz-dialetti-questions-cache-v1'; let questionsHashMeta = document.querySelector('meta[name="x-questions-sha"]'); let embeddedQuestionsHash = questionsHashMeta ? questionsHashMeta.content : null; let cachedQuestionsBlob = null; function tryLoadCachedQuestions() { try { const raw = localStorage.getItem(QUESTIONS_CACHE_KEY); if (!raw) return false; const parsed = JSON.parse(raw); if (!parsed.hash || !parsed.data || parsed.hash !== embeddedQuestionsHash) return false; if (!Array.isArray(parsed.data) || !parsed.data.length) return false; allQuestions = normalizeQuestions(parsed.data); if (allQuestions.length) { startButton.disabled = false; startButton.textContent = 'Inizia'; startButton.dataset.cached = 'true'; return true; } } catch(e) { } return false; } function cacheQuestions(data) { try { localStorage.setItem(QUESTIONS_CACHE_KEY, JSON.stringify({ hash: embeddedQuestionsHash, data })); } catch(e) { } } async function fetchQuestionsFresh() { const response = await fetch('questions.json', { cache: 'no-cache' }); if (!response.ok) throw new Error('HTTP '+response.status); const data = await response.json(); cacheQuestions(data); return data; } async function ensureQuestionsLoaded() { if (allQuestions.length) return; const hadCache = tryLoadCachedQuestions(); if (hadCache) return; startButton.disabled = true; startButton.textContent = 'Carico domande...'; try { const data = await fetchQuestionsFresh(); allQuestions = normalizeQuestions(data); startButton.disabled = false; startButton.textContent = 'Inizia'; } catch(e) { startButton.textContent = 'Errore'; showNotification('Impossibile caricare le domande. Riprova.', 'error'); } } if (startButton) { startButton.addEventListener('mouseover', ensureQuestionsLoaded, { once: true }); startButton.addEventListener('focus', ensureQuestionsLoaded, { once: true }); } const __originalStartGameLazy = startGame; startGame = async function() { if (!allQuestions.length) { await ensureQuestionsLoaded(); } __originalStartGameLazy(); }; if ('serviceWorker' in navigator) { window.addEventListener('load', () => { window.requestIdleCallback ? requestIdleCallback(registerSW) : setTimeout(registerSW, 1200); }); function registerSW() { navigator.serviceWorker.register('sw.js').then(reg => { console.log('SW registered', reg.scope); }).catch(err => console.warn('SW registration failed', err)); } }</script>
</body>
</html>

